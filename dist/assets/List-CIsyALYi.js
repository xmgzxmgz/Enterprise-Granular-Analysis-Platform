import{d as D,p as w,x as I,q as O,f as q,c as j,b as u,w as _,r as d,o as i,a as k,e as f,i as T,t as A,u as z,_ as E}from"./index-H_6N781W.js";import{f as M,e as J}from"./api-CljNWEiS.js";const L={class:"wrap"},R={class:"toolbar"},F=D({__name:"List",setup(H){const S=z(),g=w(""),b=w([]),y=w(!1),V=()=>{try{return JSON.parse(localStorage.getItem("egap_tag_meta")||"{}")||{}}catch{return{}}},$=a=>{try{localStorage.setItem("egap_tag_meta",JSON.stringify(a))}catch{}};I(async()=>{var t;let a=[];try{const e=await M();a=((e==null?void 0:e.rows)||[]).map(o=>({name:o.name,desc:o.desc,color:"blue",source:"model"}))}catch{y.value=!0}try{const e=await J(),o=V(),s={};for(const l of(e==null?void 0:e.rows)||[]){const r=l.manualTags||l.tagsManual||[],p=l.modelTags||l.tagsModel||[];for(const c of r){const n=o[c]||{},h=n.createdAt||Date.now(),v=n.creator||"管理员";s[c]={name:c,color:"grey",source:((t=s[c])==null?void 0:t.source)==="model"?"mixed":"manual",creator:v,createdAt:h,createdAtText:C(h)},o[c]={creator:v,createdAt:h}}for(const c of p){const n=s[c];s[c]={name:c,color:"blue",source:n?"mixed":"model",createdAt:n==null?void 0:n.createdAt,creator:n==null?void 0:n.creator,createdAtText:n==null?void 0:n.createdAtText}}}$(o);const m=Object.values(s);for(const l of a){const r=m.find(p=>p.name===l.name);r?(r.desc=r.desc||l.desc,r.source==="model"&&r.color!=="blue"&&(r.color="blue")):m.push(l)}b.value=m}catch{}}),O(g,async a=>{const t=a.trim();if(t)try{const e=await M(t),o=((e==null?void 0:e.rows)||[]).map(s=>({name:s.name,desc:s.desc,color:"blue",source:"model"}));b.value=B(b.value,o)}catch{y.value=!0}});const B=(a,t)=>{const e={};for(const o of a)e[o.name]=o;for(const o of t){const s=e[o.name];s?(s.desc=s.desc||o.desc,s.source==="manual"&&o.source==="model"&&(s.source="mixed"),o.color==="blue"&&(s.color="blue")):e[o.name]=o}return Object.values(e)},x=q(()=>{const a=g.value.trim();return b.value.filter(t=>!a||t.name.includes(a)||(t.desc||"").includes(a))}),N=a=>{S.push({path:"/rating-profile/标签管理/标签企业列表",query:{tag:a.name}})},C=a=>{if(!a)return"";const t=new Date(a),e=o=>String(o).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())} ${e(t.getHours())}:${e(t.getMinutes())}:${e(t.getSeconds())}`};return(a,t)=>{const e=d("el-input"),o=d("el-alert"),s=d("el-empty"),m=d("el-tag"),l=d("el-table-column"),r=d("el-table"),p=d("el-card");return i(),j("div",L,[u(p,null,{default:_(()=>[t[1]||(t[1]=k("div",{class:"title"},"标签列表",-1)),k("div",R,[u(e,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=c=>g.value=c),placeholder:"搜索标签",clearable:"",style:{"max-width":"240px"}},null,8,["modelValue"])]),y.value?(i(),f(o,{key:0,type:"error",title:"后端不可联通或错误","show-icon":"",closable:""})):x.value.length?(i(),f(r,{key:2,data:x.value,height:"420",onRowClick:N},{default:_(()=>[u(l,{label:"标签",width:"220"},{default:_(({row:c})=>[c.color==="grey"?(i(),f(m,{key:0,size:"small",class:"tag-grey",effect:"plain",type:"info"},{default:_(()=>[T(A(c.name),1)]),_:2},1024)):(i(),f(m,{key:1,size:"small",type:"primary"},{default:_(()=>[T(A(c.name),1)]),_:2},1024))]),_:1}),u(l,{prop:"desc",label:"说明"}),u(l,{prop:"source",label:"来源",width:"120"}),u(l,{prop:"creator",label:"创建人",width:"140"}),u(l,{prop:"createdAtText",label:"创建时间",width:"180"})]),_:1},8,["data"])):(i(),f(s,{key:1,description:"后端无数据或未匹配到结果"}))]),_:1})])}}}),G=E(F,[["__scopeId","data-v-62e3b0be"]]);export{G as default};
